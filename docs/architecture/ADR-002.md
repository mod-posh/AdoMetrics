# ADR-002: Profiles are optional enhancements; derived fields are namespaced

## Title

**ADR-002: Profiles optional; derived fields live under `.derived`.**

### Status

Proposed → Accepted

### Context

BAT encodes important metadata inside naming conventions (buildNumber, definition name, etc.). Other users may have different conventions or none. We need a way to:

* support “no-frills” use with zero config
* support enhanced metadata extraction when profiles exist
* avoid contaminating the canonical schema with consumer-specific fields

### Decision

1. **Profiles are optional**. The module must work without any profile files.
2. Profiles are used to enhance behavior:

   * Provide defaults (org/project/timezone/definitionIds)
   * Provide per-definition mapping (labels)
   * Provide parsing rules for derived metadata
3. All non-standard metadata extracted from conventions is stored under:

   * `derivedParsed` (boolean)
   * `derived` (object/hashtable)
4. Canonical top-level fields remain stable and generic; consumer-specific values live under `.derived`.

### Consequences

* Pros:

  * “Works out of the box” with standard ADO fields
  * Supports BAT conventions without making BAT the module
  * Avoids breaking schema when consumers add/remove derived fields
* Cons:

  * Consumers need to understand `.derived` to access enhanced fields
  * Derived parsing rules need clear documentation and test coverage

### Compatibility rules

* Import must always ensure `derivedParsed` and `derived` exist (even if empty).
* Derived parsing failures do not prevent canonical row creation.
